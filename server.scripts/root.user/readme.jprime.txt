## this file resides in ~root
##mihail.stoynov jprime README FILE

# controll the application (mostly you have to do './jprime.sh update' - git pull, rebuild, and restart)
./jprime.sh

## TALK TO MYSQL
# talk with the database
ssh root@jprime.io -L3306:localhost:3306 # opens the local port 3306
ssh root@jprime.io -L3307:localhost:3306 # opens the local port 3307 if 3306 is bisy
# then locally
mysql -h 127.0.0.1 -P 3307 -u root -p


## MORE INFO

## USER
#I created a jprime user with limited credentials, so that the app will not start with root access
# $useradd jprime

## SERVICE
#the app will start as a service, the service is enabled, so on reboot, the service will restart
# if you edit the service, you have to do 'systemctl daemon-reload' to reload the new conf
# the service conf is here: /etc/systemd/system/jprime.service

## SSH
#i added myself in .ssh/authorized_keys so that I log in without a password

##(FIREWALL)
#there is an iptables rule so that 80 -> 8080 because we want to start the app with a limited user
#iptables -t nat -I PREROUTING -p tcp --dport 80 -j REDIRECT --to-ports 8080
ip addr add 192.168.1.1/32 dev eth0
sysctl net.ipv4.ip_forward=1
sysctl net.ipv4.conf.all.route_localnet=1 #maj ne

## IPTABLES rules
Generated by iptables-save v1.4.21 on Sat Mar 28 21:12:05 2015
*nat
:PREROUTING ACCEPT [2:70]
:INPUT ACCEPT [3:192]
:OUTPUT ACCEPT [5:1955]
:POSTROUTING ACCEPT [5:1955]
-A PREROUTING -p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.1.1:8080
COMMIT
# Completed on Sat Mar 28 21:12:05 2015
# Generated by iptables-save v1.4.21 on Sat Mar 28 21:12:05 2015
*filter
:INPUT DROP [5:1608]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [986:232980]
-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -d 192.168.1.1/32 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT
COMMIT
# Completed on Sat Mar 28 21:12:05 2015